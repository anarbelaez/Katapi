<style>
@media screen and (min-width: 800px) {
  .modal-dialog {
    margin-right: 0 !important;
    margin-top: 0 !important;
  }
  .circle{
    width: 12px;
    height: 12px;
    -webkit-border-radius: 25px;
    -moz-border-radius: 25px;
    border-radius: 25px;
  }
}
</style>
<% if @user.goals.present? %>
<div class="row g-4">
  <div class="col-md-8 order-1 order-md-0 mb-5 pb-5">
    <h5 class="pb-2 mb-3 border-bottom">Goals summary</h5>
    <div class="row gx-3">
      <div class="col-4 col-sm-4 align-items-stretch mb-2">
        <div class="card border-0 rounded-4 bg-secondary shadow-sm notscale" style="">
          <div class="card-body d-flex justify-content-between">
            <%= image_tag "babytree2.svg", class: "img-fluid d-none d-md-block", width: "90px" %>
            <div class="text-end">
              <p class="fs-3 m-0 mb-1"><%= @baby_percentage %>%</p>
              <p class="card-text fs-08 mb-1 fw-bold text-muted ">Baby trees</p>
              <div class=""><%= link_to "See goals", by_status_path(0), class: "rounded-pill text-decoration-none link-danger fs-07" %></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-4 col-sm-4 align-items-stretch mb-2">
        <div class="card border-0 rounded-4 bg-secondary shadow-sm notscale" style="">
          <div class="card-body d-flex justify-content-between">
            <%= image_tag "babytree1.svg", class: "img-fluid d-none d-lg-block ms-2", width: "80px" %>

            <div class="text-end">
              <p class="fs-3 m-0 mb-1"><%= @young_percentage %>%</p>
              <p class="card-text fs-08 mb-1 fw-bold text-muted">Young trees</p>
              <div class=""><%= link_to "See goals", by_status_path(1), class: "rounded-pill text-decoration-none link-primary fs-07" %></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-4 col-sm-4 align-items-stretch mb-2">
        <div class="card border-0 rounded-4 bg-secondary shadow-sm notscale" style="">
          <div class="card-body d-flex justify-content-between">
            <%= image_tag "japantree1.svg", class: "img-fluid d-none d-lg-block", width: "120px" %>
            <div class="text-end">
              <p class="fs-3 m-0 mb-1"><%= @adult_percentage %>%</p>
              <p class="card-text fs-08 mb-1 fw-bold text-muted">Adult trees</p>
              <div class=""><%= link_to "See goals", by_status_path(2), class: "rounded-pill text-decoration-none link-success fs-07" %></div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <h5 class="mt-3 pt-3 pb-2 mb-3 border-bottom">General activity</h5>
    <div class="row gx-3">
      <div class="col-4">
        <div class="mx-0 card rounded-4 border-0 bg-secondary notscale bg-cover" style="height: 100%; background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0)), url(https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/4b37e17d-1ebb-4caa-90c6-fabbb17caf51/df5k96c-d2c2009e-d9f7-4cd9-8b6d-61d0c4f23d93.png/v1/fill/w_946,h_797,q_80,strp/fractal_tree_in_the_fall_by_bucbowie_df5k96c-fullview.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9Nzk3IiwicGF0aCI6IlwvZlwvNGIzN2UxN2QtMWViYi00Y2FhLTkwYzYtZmFiYmIxN2NhZjUxXC9kZjVrOTZjLWQyYzIwMDllLWQ5ZjctNGNkOS04YjZkLTYxZDBjNGYyM2Q5My5wbmciLCJ3aWR0aCI6Ijw9OTQ2In1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmltYWdlLm9wZXJhdGlvbnMiXX0.qqKTKEMvpcEknE3b2bd46_IPbMoy_K6CTihADQH_ugM)">
        </div>
      </div>
      <div class="mx-0 col-8">
        <div class="card notscale rounded-4 border-0 bg-secondary">
          <div class="card-body">
            <div>
            <div class="pb-3 d-flex justify-content-between align-items-center">
              <p class="m-0 fw-bold fst-italic">Goals</p>
              <%= link_to "Add a new goal", new_goal_path, class: "bg-gradient badge bg-primary p-1 px-2 link-dark rounded-pill text-decoration-none" %>
            </div>
                <div class="progress rounded-4 mb-2">
                  <div class="progress-bar bg-success" role="progressbar" aria-label="Segment one" style="width: <%= @alive_percentage %>%" aria-valuenow="<%= @alive_percentage %>" aria-valuemin="0" aria-valuemax="100"><span class="fs-07 fw-bold fst-italic text-dark px-2"><%= @alive_percentage %>%</span></div>
                  <div class="progress-bar bg-danger" role="progressbar" aria-label="Segment two" style="width: <%= @dead_percentage %>%" aria-valuenow="<%= @dead_percentage %>" aria-valuemin="0" aria-valuemax="100"><span class="fs-07 fw-bold fst-italic text-dark px-2"><%= @dead_percentage %>%</span></div>
                </div>
                <div class="d-flex justify-content-end align-items-center fs-07">
                  <div class="circle me-2 bg-success"></div><span class="fst-italic">Alive trees percentage</span>
                  <div class="circle ms-3 me-2 bg-danger"></div><span class="fst-italic">Dead trees percentage</span>
                </div>
                <div class="d-flex mt-3 mb-2">
                  <table class="table text-light fs-08 w-50">
                    <tbody>
                      <tr>
                        <td class="fst-italic fw-bold">• Alive trees</td>
                        <td><%= @alive_count %></td>
                      </tr>
                      <tr>
                        <td class="fst-italic fw-bold">• Dead trees</td>
                        <td><%= @dead_count %></td>
                      </tr>
                    </tbody>
                  </table>
                  <div class="card border-end border-bottom border-primary border-2 notscale rounded-4 bg-body ms-3 w-50">
                    <div class="card-body text-center fst-italic ">
                      <span><%= message(@alive_count, @dead_count)%></span>
                    </div>
                  </div>
                </div>
            </div>
            <div>
              <p class="m-0 fw-bold fst-italic">Tasks</p>
                <div class="d-flex justify-content-between">
                <div class="col-6 pe-2">
                  <table class="table text-light fs-08 mt-3">
                    <tbody>
                      <tr>
                        <td class="fst-italic fw-bold">• <span class="">Not started</span></td>
                        <td><%= @not_started_tasks %></td>
                      </tr>
                      <tr>
                        <td class="fst-italic fw-bold">• <span class="">In progress</span></td>
                        <td><%= @in_progress_tasks %></td>
                      </tr>
                      <tr>
                        <td class="fst-italic fw-bold">• <span class="">Completed</span></td>
                        <td><%= @done_tasks %></td>
                      </tr>
                    </tbody>
                  </table>
                  </div>
                  <div class="col-6">
                  <div class="card border-0 notscale rounded-4 bg-body ms-2">
                    <div class="card-body fs-07 py-3">
                      <p class="m-0 fs-08 fst-italic text-center mb-2">Number of tasks by status</p>
                      <%= pie_chart current_user.tasks.group(:status).count, height: "50px", legend: false, library: {animation: {easing: 'easeOutQuad'}, elements: {arc: {borderWidth: 0}}}, colors: ["#ff7979", "#badc58","#7ed6df"], empty: "Oops you haven't any task to see here!" %>
                      <div class="text-center fs-07 mt-2">
                        <span class="badge bg-danger rounded-4 px-1 text-dark fst-italic fw-bold">Not started</span>
                        <span class="badge bg-success rounded-4 px-1 text-dark fst-italic fw-bold">In progress</span>
                        <span class="badge bg-primary rounded-4 px-1 text-dark fst-italic fw-bold">Completed</span>
                      </div>
                    </div>
                  </div>
                  </div>

                </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <%# Aqui se renderizan las goals %>
    <div class="mt-5 pb-1 d-flex justify-content-between align-items-center border-bottom">
      <h5 class="m-0 p-0">Goals</h5>
      <%= link_to "All goals", goals_path, class: "text-decoration-none link-info fs-07" %>
    </div>

    <div class="row gx-2">
      <% @goals.each do |goal| %>
        <div class="col-6 col-sm-3">
          <div class="d-flex align-items-stretch">
            <a href="" class="text-decoration-none link-dark" data-bs-toggle="modal" data-bs-target="#modalGoal"
              data-bs-goal-name="<%= goal.name %>" data-bs-goal-description="<%= goal.description %>" data-bs-goal-category="<%= goal.category %>"
              data-bs-goal-date="<%= goal.completion_date %>" data-bs-goal-url="<%= request.base_url %>/goals/<%= goal.id %>">
              <%= render "card_goal_board", goal: goal %>
            </a>
            <div class="modal fade mt-5" id="modalGoal" tabindex="-1" aria-labelledby="modalGoalLabel" aria-hidden="true">
              <%= render "modal_for_goal", goal: goal %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <%# Carousel %>


    <div id="carouselCards" class="carousel slide" data-controller="carousel-cards" data-bs-interval="false" data-ride="carousel" data-pause="hover">
  <div class="carousel-inner p-1">

    <% i = 0 %>
    <%#= Iteramos sobre listas de maximo 6 elementos %>
    <% @goals.last(11).each_slice(4) do |sublist| %>
    <%# Se crea un item del carousel con estos elementos %>
      <div class="carousel-card carousel-item" data-carousel-cards-target="item">
          <div class="row g-3">

          <%# Presentamos el objeto en forma de card %>
            <% sublist.each do |object| %>
              <div class="col-6 col-md-3">
              <a href="" class="text-decoration-none link-dark" data-bs-toggle="modal" data-bs-target="#modalGoal"
              data-bs-goal-name="<%= object.name %>" data-bs-goal-description="<%= object.description %>" data-bs-goal-category="<%= object.category %>"
              data-bs-goal-date="<%= object.completion_date %>" data-bs-goal-url="/goals/<%= object.id %>">
              <%= render "card_goal_board", goal: object %>
            </a>
            <div class="modal fade mt-5" id="modalGoal" tabindex="-1" aria-labelledby="modalGoalLabel" aria-hidden="true">
              <%= render "modal_for_goal", goal: object %>
            </div>
                <% i += 1 %>
              </div>

              <%# Si existen mas de 11 objetos entonces mostramos una ghost card "Ver mas" %>
              <% if i == 11 %>
              <div class="col-6 col-md-2">
                <%= render "ghost_card"%>
              </div>
              <% end %>
            <% end %>
          </div>
      </div>
    <% end %>

  </div>

  <%# Si se muestran mas de 6 elementos entonces los controles del carousel son visibles %>
  <% unless @goals.size <= 6 %>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselCards" data-bs-slide="prev">
      <span class="carousel-control-prev-icon " aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselCards" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  <% end %>
</div>

  </div>

  <div class="col-md-4 order-0 order-md-1">
    <div class="position-sticky" style="top: 1rem;">
      <div class="px-3 pt-3 pb-1 mb-3 bg-secondary rounded-4">
        <h5 class="my-1 mb-3">Upcoming tasks</h5>
          <p class="fs-08"><%= @upcoming_tasks_day %></p>
          <% @upcoming_tasks&.each do |upcoming_task| %>
          <div class="col-12">
            <%= render 'tasks/partials/card_upcoming_task', task: upcoming_task %>

          </div>
          <% end %>
      </div>

      <div class="p-2 mb-3 bg-secondary rounded-4">
        <h5 class="mt-3 mb-2 px-2">Monthly calendar</h5>
        <div class="rounded-4 text-light">
          <%= render 'tasks/partials/calendar' %>
        </div>
      </div>
    </div>
  </div>


</div>

<% else %>

<div class="row justify-content-center" style="height: 80vh">
  <div class="col-12">
    <div class="notscale card border-0 bg-transparent" style="">
      <div class="card-body border-0 bg-transparent d-flex align-items-center">
      <div class="w-25">
        <%= image_tag "https://cdn.dribbble.com/userupload/3223957/file/original-7d1a606fab9ae5ddeed8e62d0e6a034c.png?compress=1&resize=1200x861",
          class: "img-fluid", style: "border-radius: 30% 70% 70% 30% / 54% 50% 50% 46%" %>
      </div>
          <div class="ms-4">
            <h5 class="card-title fs-4">Hmmm... nothing to see here! </h5>
            <p class="card-text text-end"><%= link_to "Why don't you create a new goal?", new_goal_path, class: "text-decoration-none link-warning fw-bold" %></p>
          </div>
      </div>
    </div>

  </div>
</div>
<% end %>
</div>
<script>
  const modalGoal = document.getElementById('modalGoal')
    modalGoal.addEventListener('show.bs.modal', event => {
    const goal = event.relatedTarget
    const goalName = goal.getAttribute('data-bs-goal-name')
    const goalDescription = goal.getAttribute('data-bs-goal-description')
    const goalCategory = goal.getAttribute('data-bs-goal-category')
    const goalDate = goal.getAttribute('data-bs-goal-date')
    const goalUrl = goal.getAttribute('data-bs-goal-url')
    const goalNameM = modalGoal.querySelector('#goalName')
    const goalDescriptionM = modalGoal.querySelector('#goalDescription')
    const goalCategoryM = modalGoal.querySelector('#goalCategory')
    const goalDateM = modalGoal.querySelector('#goalDate')
    const goalURL = modalGoal.querySelector('#goalURL')
    console.log(goalUrl)
    goalNameM.textContent = `${ goalName }`
    goalDescriptionM.textContent = `${ goalDescription }`
    goalCategoryM.textContent = `${ goalCategory }`
    goalDateM.textContent = `${ goalDate }`
    goalURL.textContent = `${ goalUrl }`
    console.log(goalURL)
  })
</script>


<script>
const exampleEl = document.getElementById('elTooltip')
const tooltip = new bootstrap.Tooltip(exampleEl, options)
</script>
